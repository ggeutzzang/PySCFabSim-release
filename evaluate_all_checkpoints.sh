#!/bin/bash

###############################################################################
# λ¨λ“  μ²΄ν¬ν¬μΈνΈ ν‰κ°€ μ¤ν¬λ¦½νΈ
#
# λ©μ : RL ν•™μµ μ¤‘ μ €μ¥λ μ²΄ν¬ν¬μΈνΈλ¥Ό μμ°¨μ μΌλ΅ ν‰κ°€ν•μ—¬
#       ν•™μµ μ§„ν–‰μ— λ”°λ¥Έ μ„±λ¥ λ³€ν™”λ¥Ό μ¶”μ 
#
# μ‚¬μ©λ²•: ./evaluate_all_checkpoints.sh
###############################################################################

EXP_DIR="experiments/DEMO_0_ds_HVLM_a5_tp30_reward2_di_fifo_<I"

echo "=================================================="
echo "π” μ²΄ν¬ν¬μΈνΈ ν‰κ°€ μ‹μ‘"
echo "π“ μ‹¤ν— λ””λ ‰ν† λ¦¬: $EXP_DIR"
echo "=================================================="
echo ""

# 1. μµμΆ… λ¨λΈ ν‰κ°€
echo "β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”"
echo "π“ μµμΆ… λ¨λΈ (trained.weights) ν‰κ°€"
echo "β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”"
python3 rl_test_demo.py "$EXP_DIR" trained.weights
echo ""

# 2. κ° μ²΄ν¬ν¬μΈνΈ ν‰κ°€
for checkpoint in "$EXP_DIR"/checkpoint__*_steps.zip; do
    if [ -f "$checkpoint" ]; then
        filename=$(basename "$checkpoint")
        echo "β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”"
        echo "π“ μ²΄ν¬ν¬μΈνΈ: $filename"
        echo "β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”"
        python3 rl_test_demo.py "$EXP_DIR" "$filename"
        echo ""
    fi
done

echo "=================================================="
echo "β… λ¨λ“  μ²΄ν¬ν¬μΈνΈ ν‰κ°€ μ™„λ£!"
echo "=================================================="

# 3. κ²°κ³Ό μ”μ•½ μ¶λ ¥
echo ""
echo "π“ ν‰κ°€ κ²°κ³Ό μ”μ•½ (JSON νμΌ)"
echo "β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”"
ls -lh "$EXP_DIR"/*.json | tail -10
